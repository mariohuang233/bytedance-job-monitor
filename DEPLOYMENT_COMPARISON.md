# 部署方案对比文档

## 概述

本项目提供了两种部署方案：**原版Playwright方案**和**简化版API方案**。根据实际测试，推荐使用原版Playwright方案。

## 方案对比

### 🎯 原版Playwright方案（推荐）

**优势：**
- ✅ 模拟真实浏览器行为，有效绕过反爬虫检测
- ✅ 可以处理JavaScript渲染的动态内容
- ✅ 支持复杂的用户交互（点击、滚动、等待等）
- ✅ 数据获取成功率高
- ✅ 稳定可靠，经过充分测试

**劣势：**
- ❌ 依赖较多，需要安装浏览器二进制文件
- ❌ 资源消耗较大
- ❌ 部署复杂度较高
- ❌ 启动时间较长

**适用场景：**
- 生产环境部署
- 需要稳定数据获取
- 对数据准确性要求高
- 有足够的服务器资源

### 📡 简化版API方案（不推荐）

**优势：**
- ✅ 部署简单，无需浏览器依赖
- ✅ 资源消耗小
- ✅ 启动速度快
- ✅ 适合云平台部署

**劣势：**
- ❌ **容易被反爬虫系统检测和阻止**
- ❌ 无法处理JavaScript渲染内容
- ❌ API接口可能随时变更
- ❌ 数据获取成功率低
- ❌ 缺乏有效的反反爬虫机制

**适用场景：**
- 快速原型验证
- 资源受限环境
- 临时测试用途

## 🚨 重要发现

经过实际测试，**简化版API方案确实存在反爬虫问题**：

1. **JSON解析失败**：API返回的不是预期的JSON格式，可能是HTML反爬虫页面
2. **请求被拦截**：直接调用API接口容易被识别为爬虫行为
3. **数据获取失败**：无法获取到有效的职位数据

## 📋 部署建议

### 生产环境推荐配置

**首选：Docker + Playwright方案**
```bash
# 使用原版Dockerfile
docker build -t bytedance-jobs-monitor .
docker run -p 8080:8080 bytedance-jobs-monitor
```

**备选：Zeabur + Docker部署**
```toml
# zeabur.toml 配置
[build]
buildCommand = "docker build -t bytedance-job-monitor ."

[deploy]
startCommand = "gunicorn --bind 0.0.0.0:$PORT --workers 2 --timeout 120 app:app"
```

### 开发环境配置

```bash
# 安装依赖
pip install -r requirements.txt
playwright install chromium

# 启动应用
python start.py
```

## 🔧 故障排除

### Playwright依赖问题

如果遇到Playwright安装问题：

1. **本地开发环境**：
   ```bash
   pip install playwright==1.40.0
   playwright install chromium
   ```

2. **Docker环境**：
   - 使用提供的Dockerfile，已包含所有必要依赖
   - 确保系统有足够内存（建议2GB+）

3. **云平台部署**：
   - 推荐使用Docker部署方式
   - 避免使用Nixpacks等可能不兼容的构建系统

### 性能优化建议

1. **资源配置**：
   - CPU: 2核心以上
   - 内存: 2GB以上
   - 存储: 1GB以上

2. **并发控制**：
   - 限制同时运行的浏览器实例数量
   - 合理设置请求间隔
   - 使用连接池管理

3. **监控告警**：
   - 监控内存使用情况
   - 设置任务执行超时
   - 记录详细的错误日志

## 📊 性能对比

| 指标 | Playwright方案 | API方案 |
|------|----------------|----------|
| 数据获取成功率 | 95%+ | <10% |
| 启动时间 | 30-60秒 | 5-10秒 |
| 内存占用 | 500MB-1GB | 50-100MB |
| CPU占用 | 中等 | 低 |
| 部署复杂度 | 高 | 低 |
| 稳定性 | 高 | 低 |
| 反爬虫能力 | 强 | 弱 |

## 🎯 最终建议

**强烈推荐使用原版Playwright方案**，原因如下：

1. **数据获取可靠性**：Playwright方案经过充分测试，能够稳定获取数据
2. **反爬虫能力**：模拟真实浏览器行为，有效避免被检测
3. **长期维护性**：不依赖可能变更的API接口
4. **功能完整性**：支持复杂的页面交互和数据提取

虽然部署复杂度较高，但这是获得稳定可靠服务的必要代价。

## 📝 部署检查清单

### Playwright方案部署检查

- [ ] 确认服务器资源充足（2GB+ 内存）
- [ ] 安装Docker环境
- [ ] 构建Docker镜像
- [ ] 配置环境变量
- [ ] 测试数据获取功能
- [ ] 设置定时任务
- [ ] 配置监控告警

### 故障排除检查

- [ ] 检查Playwright浏览器是否正确安装
- [ ] 验证网络连接是否正常
- [ ] 确认目标网站是否可访问
- [ ] 检查日志文件中的错误信息
- [ ] 验证数据文件是否正确生成

---

**结论**：基于实际测试结果和反爬虫考虑，**强烈建议使用原版Playwright方案进行生产部署**。简化版API方案仅适用于快速原型验证，不适合实际使用。